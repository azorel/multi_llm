<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ video.name }} - Video Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .video-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        .stat-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        .transcript-box {
            max-height: 400px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        .ai-analysis {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .integration-prompt {
            background: #28a745;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .hashtag {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin: 2px;
        }
        .insight-item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="video-header">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <h1><i class="fas fa-play-circle"></i> {{ video.name }}</h1>
                    <p class="lead">{{ video.channel }} â€¢ {{ video.duration_formatted }}</p>
                </div>
                <div class="col-md-4 text-end">
                    <a href="{{ video.url }}" target="_blank" class="btn btn-light btn-lg">
                        <i class="fab fa-youtube"></i> Watch on YouTube
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Action Bar -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="btn-group me-3" role="group">
                    <button class="btn {% if video.mark_for_delete %}btn-danger{% else %}btn-outline-danger{% endif %}" 
                            onclick="markVideo({{ video.id }}, 'delete')">
                        <i class="fas fa-trash"></i> Mark for Delete
                    </button>
                    <button class="btn {% if video.mark_for_edit %}btn-warning{% else %}btn-outline-warning{% endif %}" 
                            onclick="markVideo({{ video.id }}, 'edit')">
                        <i class="fas fa-edit"></i> Mark for Edit
                    </button>
                    <button class="btn {% if video.mark_for_integration %}btn-success{% else %}btn-outline-success{% endif %}" 
                            onclick="markVideo({{ video.id }}, 'integration')">
                        <i class="fas fa-plus-circle"></i> Mark for Integration
                    </button>
                </div>
                <a href="/video_management" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to List
                </a>
            </div>
        </div>
        
        <!-- Video Stats -->
        <div class="row mb-4">
            <div class="col-md-2">
                <div class="stat-box">
                    <h4>{{ "{:,}".format(video.view_count) if video.view_count else 'N/A' }}</h4>
                    <small>Views</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="stat-box">
                    <h4>{{ "{:,}".format(video.like_count) if video.like_count else 'N/A' }}</h4>
                    <small>Likes</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="stat-box">
                    <h4>{{ "%.1f"|format(video.quality_score * 100) if video.quality_score else 'N/A' }}%</h4>
                    <small>Quality Score</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="stat-box">
                    <h4>{{ video.technical_complexity or 'N/A' }}/10</h4>
                    <small>Complexity</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="stat-box">
                    <h4>{{ "%.1f"|format(video.relevance_score * 100) if video.relevance_score else 'N/A' }}%</h4>
                    <small>Relevance</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="stat-box">
                    <h4>{{ video.upload_date or 'Unknown' }}</h4>
                    <small>Upload Date</small>
                </div>
            </div>
        </div>
        
        <!-- Video Thumbnail and Description -->
        <div class="row mb-4">
            <div class="col-md-4">
                {% if video.thumbnail_url %}
                <img src="{{ video.thumbnail_url }}" class="img-fluid rounded" alt="Video Thumbnail">
                {% else %}
                <div class="bg-secondary d-flex align-items-center justify-content-center rounded" style="height: 250px;">
                    <i class="fas fa-play-circle fa-5x text-white"></i>
                </div>
                {% endif %}
            </div>
            <div class="col-md-8">
                <h3>Description</h3>
                <div class="bg-light p-3 rounded">
                    {{ video.description[:500] if video.description else 'No description available' }}
                    {% if video.description and video.description|length > 500 %}...{% endif %}
                </div>
                
                <!-- Tags and Hashtags -->
                <div class="mt-3">
                    <h5>Hashtags</h5>
                    {% if video.hashtags %}
                        {% for hashtag in video.hashtags %}
                        <span class="hashtag">{{ hashtag }}</span>
                        {% endfor %}
                    {% endif %}
                    
                    {% if video.ai_extracted_hashtags %}
                        <h6 class="mt-2">AI-Generated Hashtags</h6>
                        {% for hashtag in video.ai_extracted_hashtags %}
                        <span class="hashtag">{{ hashtag }}</span>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- AI Analysis -->
        {% if video.ai_context or video.ai_detailed_summary %}
        <div class="ai-analysis">
            <h3><i class="fas fa-brain"></i> AI Analysis</h3>
            
            {% if video.ai_context %}
            <div class="mb-3">
                <h5>Context</h5>
                <p>{{ video.ai_context }}</p>
            </div>
            {% endif %}
            
            {% if video.ai_detailed_summary %}
            <div class="mb-3">
                <h5>Detailed Summary</h5>
                <p>{{ video.ai_detailed_summary }}</p>
            </div>
            {% endif %}
            
            {% if video.ai_key_insights %}
            <div class="mb-3">
                <h5>Key Insights</h5>
                {% for insight in video.ai_key_insights %}
                <div class="insight-item">
                    <i class="fas fa-lightbulb"></i> {{ insight }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- Integration Prompt -->
        {% if video.integration_prompt %}
        <div class="integration-prompt">
            <h3><i class="fas fa-plus-circle"></i> Integration Benefits</h3>
            <p>{{ video.integration_prompt }}</p>
            
            {% if video.mark_for_integration %}
            <div class="mt-3">
                <button class="btn btn-light" onclick="approveIntegration({{ video.id }})">
                    <i class="fas fa-check"></i> Approve Integration
                </button>
                <button class="btn btn-outline-light" onclick="rejectIntegration({{ video.id }})">
                    <i class="fas fa-times"></i> Reject Integration
                </button>
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- Video Transcript -->
        {% if video.transcript %}
        <div class="mb-4">
            <h3>Full Transcript</h3>
            <div class="transcript-box">
                {{ video.transcript }}
            </div>
        </div>
        {% endif %}
        
        <!-- Technical Details -->
        <div class="row">
            <div class="col-md-6">
                <h4>Technical Details</h4>
                <table class="table table-sm">
                    <tr>
                        <td><strong>Video ID:</strong></td>
                        <td>{{ video.video_id }}</td>
                    </tr>
                    <tr>
                        <td><strong>Duration:</strong></td>
                        <td>{{ video.duration_seconds }} seconds</td>
                    </tr>
                    <tr>
                        <td><strong>Language:</strong></td>
                        <td>{{ video.language or 'Unknown' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Category:</strong></td>
                        <td>{{ video.category_id or 'Unknown' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Age Limit:</strong></td>
                        <td>{{ video.age_limit or 'None' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Processed By:</strong></td>
                        <td>{{ video.processing_agent or 'Unknown' }}</td>
                    </tr>
                </table>
            </div>
            <div class="col-md-6">
                <h4>Settings</h4>
                <table class="table table-sm">
                    <tr>
                        <td><strong>Auto-Check:</strong></td>
                        <td>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" 
                                       {% if video.auto_check_enabled %}checked{% endif %}
                                       onchange="toggleAutoCheck({{ video.id }}, this.checked)">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Processing Status:</strong></td>
                        <td><span class="badge bg-success">{{ video.processing_status or 'Unknown' }}</span></td>
                    </tr>
                    <tr>
                        <td><strong>Created:</strong></td>
                        <td>{{ video.created_at }}</td>
                    </tr>
                    <tr>
                        <td><strong>Updated:</strong></td>
                        <td>{{ video.updated_at }}</td>
                    </tr>
                </table>
                
                {% if video.integration_notes %}
                <div class="mt-3">
                    <h5>Integration Notes</h5>
                    <div class="bg-light p-2 rounded">
                        {{ video.integration_notes }}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function markVideo(videoId, action) {
            const data = {
                video_id: videoId,
                action: action,
                notes: prompt(`Notes for ${action}:`) || ''
            };
            
            fetch('/api/mark_video', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    location.reload();
                } else {
                    alert('Action failed');
                }
            });
        }
        
        function toggleAutoCheck(videoId, enabled) {
            const data = {
                video_id: videoId,
                enabled: enabled
            };
            
            fetch('/api/update_auto_check', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (!result.success) {
                    alert('Auto-check update failed');
                    location.reload();
                }
            });
        }
        
        function approveIntegration(videoId) {
            const data = {
                video_id: videoId,
                action: 'approve'
            };
            
            fetch('/api/integration_workflow', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                alert(result.message);
                location.reload();
            });
        }
        
        function rejectIntegration(videoId) {
            const reason = prompt('Reason for rejection:');
            if (!reason) return;
            
            const data = {
                video_id: videoId,
                action: 'reject',
                reason: reason
            };
            
            fetch('/api/integration_workflow', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                alert(result.message);
                location.reload();
            });
        }
    </script>
</body>
</html>