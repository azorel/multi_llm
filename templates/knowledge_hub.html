{% extends "base.html" %}

{% block title %}Knowledge Hub - LifeOS{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">🧠 Knowledge Hub</h1>
    <p class="page-subtitle">
        Central repository for all your knowledge, insights, and processed content. Automatically populated from YouTube, GitHub, and other sources.
    </p>
</div>

<div class="database-container">
    <div class="database-header">
        <span class="database-title">Knowledge Entries ({{ entries|length }} items)</span>
        <button class="add-button" onclick="addNewEntry()">+ Add Entry</button>
    </div>
    
    <table class="database-table">
        <thead>
            <tr>
                <th>Title</th>
                <th>Category</th>
                <th>Content Preview</th>
                <th>Tags</th>
                <th>Status</th>
                <th>Created</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in entries %}
            <tr>
                <td style="font-weight: 600;">{{ entry.title }}</td>
                <td>
                    <span class="status-pill status-{{ entry.category.lower().replace(' ', '-') if entry.category else 'general' }}">
                        {{ entry.category or 'General' }}
                    </span>
                </td>
                <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--notion-text-light);">
                    {{ (entry.content[:100] + '...') if entry.content and entry.content|length > 100 else (entry.content or 'No content') }}
                </td>
                <td style="font-size: 12px;">
                    {% if entry.tags %}
                        {% for tag in entry.tags.split(',') %}
                            <span style="background: var(--notion-blue-light); color: var(--notion-blue); padding: 2px 6px; border-radius: 3px; margin-right: 4px;">{{ tag.strip() }}</span>
                        {% endfor %}
                    {% else %}
                        <span style="color: var(--notion-text-light);">No tags</span>
                    {% endif %}
                </td>
                <td>
                    <span class="status-pill status-{{ entry.status.lower() if entry.status else 'active' }}">
                        {{ entry.status or 'Active' }}
                    </span>
                </td>
                <td style="color: var(--notion-text-light); font-size: 12px;">
                    {{ entry.created_date.split(' ')[0] if entry.created_date else 'N/A' }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Knowledge Stats -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-top: 32px;">
    <div class="notion-card">
        <div class="card-title">📊 Knowledge Stats</div>
        <div class="card-content">
            Total entries: {{ entries|length }}<br>
            {% set categories = entries | map(attribute='category') | select | list %}
            Categories: {{ categories | unique | list | length }}<br>
            Recent additions: {{ entries | selectattr('created_date', 'defined') | list | length }}
        </div>
    </div>
    
    <div class="notion-card">
        <div class="card-title">🏷️ Popular Tags</div>
        <div class="card-content">
            {% set all_tags = [] %}
            {% for entry in entries if entry.tags %}
                {% for tag in entry.tags.split(',') %}
                    {% set _ = all_tags.append(tag.strip()) %}
                {% endfor %}
            {% endfor %}
            {% set unique_tags = all_tags | unique | list %}
            {% for tag in unique_tags[:5] %}
                <span style="background: var(--notion-purple); color: white; padding: 2px 6px; border-radius: 3px; margin-right: 4px; font-size: 11px;">{{ tag }}</span>
            {% endfor %}
        </div>
    </div>
    
    <div class="notion-card">
        <div class="card-title">🔄 Auto Import Status</div>
        <div class="card-content">
            <span style="color: var(--notion-green);">✅ YouTube processing active</span><br>
            <span style="color: var(--notion-green);">✅ GitHub analysis active</span><br>
            <span style="color: var(--notion-blue);">📈 Auto-categorization enabled</span>
        </div>
    </div>
</div>

<script>
function addNewEntry() {
    const title = prompt('Entry title:');
    if (title) {
        const category = prompt('Category:', 'General');
        const content = prompt('Content:');
        const tags = prompt('Tags (comma-separated):');
        
        fetch('/add-item', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                table: 'knowledge_hub',
                data: {
                    title: title,
                    category: category || 'General',
                    content: content || '',
                    tags: tags || '',
                    status: 'Active'
                }
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Failed to add entry');
            }
        });
    }
}
</script>
{% endblock %}