{% extends "base.html" %}

{% block title %}Business Opportunities - LifeOS{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">üí° Business Opportunities</h1>
    <p class="page-subtitle">
        AI-discovered business opportunities from lifestyle content analysis.
        <span style="float: right; color: var(--notion-text-light); font-size: 12px;">
            Total opportunities: {{ opportunities|length }}
            <button onclick="location.reload()" style="margin-left: 8px; background: var(--notion-blue); color: white; border: none; padding: 2px 6px; border-radius: 3px; font-size: 11px; cursor: pointer;">
                üîÑ Refresh
            </button>
        </span>
    </p>
</div>

<!-- Opportunities Grid -->
<div class="database-container">
    <div class="database-header">
        <span class="database-title">üí° All Business Opportunities ({{ opportunities|length }})</span>
        <button onclick="createOpportunity()" class="add-button">‚ûï Add Opportunity</button>
    </div>
    
    {% if opportunities %}
    <table class="database-table">
        <thead>
            <tr>
                <th>Category</th>
                <th>Opportunity</th>
                <th>Revenue Model</th>
                <th>Revenue Potential</th>
                <th>Status</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for opp in opportunities %}
            <tr class="opportunity-row category-{{ opp.category.lower().replace(' ', '-') }}">
                <td>
                    <span class="status-pill category-{{ opp.category.lower().replace(' ', '-') }}">
                        {{ opp.category }}
                    </span>
                </td>
                <td>
                    <div style="font-weight: 600; margin-bottom: 4px;">{{ opp.title }}</div>
                    <div style="font-size: 12px; color: var(--notion-text-light);">
                        {{ opp.description[:100] }}{% if opp.description|length > 100 %}...{% endif %}
                    </div>
                </td>
                <td style="font-size: 14px;">{{ opp.revenue_model }}</td>
                <td style="font-size: 16px; font-weight: 600; color: var(--notion-green);">
                    ${{ "{:,}".format(opp.revenue_potential) }}/month
                </td>
                <td>
                    {% if opp.status == 'identified' %}
                        <span class="status-pill status-pending">üîç Identified</span>
                    {% elif opp.status == 'approved_for_development' %}
                        <span class="status-pill status-active">‚úÖ Approved</span>
                    {% elif opp.status == 'in_development' %}
                        <span class="status-pill status-in-progress">üöß In Development</span>
                    {% else %}
                        <span class="status-pill status-default">{{ opp.status.replace('_', ' ').title() }}</span>
                    {% endif %}
                </td>
                <td style="font-size: 12px; color: var(--notion-text-light);">
                    {{ opp.created_at }}
                </td>
                <td>
                    <div style="display: flex; gap: 4px;">
                        {% if opp.status == 'identified' %}
                            <button onclick="approveOpportunity('{{ opp.id }}')" 
                                    style="background: var(--notion-green); color: white; border: none; padding: 4px 8px; border-radius: 3px; font-size: 11px; cursor: pointer;">
                                ‚úÖ Approve
                            </button>
                        {% endif %}
                        <button onclick="viewOpportunity('{{ opp.id }}')" 
                                style="background: var(--notion-blue); color: white; border: none; padding: 4px 8px; border-radius: 3px; font-size: 11px; cursor: pointer;">
                            üëÅÔ∏è View
                        </button>
                        <button onclick="editOpportunity('{{ opp.id }}')" 
                                style="background: var(--notion-orange); color: white; border: none; padding: 4px 8px; border-radius: 3px; font-size: 11px; cursor: pointer;">
                            ‚úèÔ∏è Edit
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div style="padding: 40px; text-align: center; color: var(--notion-text-light);">
        <h3>No business opportunities found</h3>
        <p>The AI system will analyze content and identify opportunities automatically.</p>
        <button onclick="createOpportunity()" class="add-button" style="margin-top: 16px;">
            üí° Create Manual Opportunity
        </button>
    </div>
    {% endif %}
</div>

<!-- Opportunity Stats -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 32px;">
    <div class="notion-card">
        <div class="card-title">üìä Total Opportunities</div>
        <div class="card-content">
            <div style="font-size: 32px; font-weight: 600; color: var(--notion-blue);">{{ opportunities|length }}</div>
            <div style="font-size: 12px; color: var(--notion-text-light);">All categories</div>
        </div>
    </div>
    
    <div class="notion-card">
        <div class="card-title">‚úÖ Approved</div>
        <div class="card-content">
            <div style="font-size: 32px; font-weight: 600; color: var(--notion-green);">
                {{ opportunities|selectattr('status', 'equalto', 'approved_for_development')|list|length }}
            </div>
            <div style="font-size: 12px; color: var(--notion-text-light);">Ready for development</div>
        </div>
    </div>
    
    <div class="notion-card">
        <div class="card-title">üí∞ Revenue Potential</div>
        <div class="card-content">
            <div style="font-size: 24px; font-weight: 600; color: var(--notion-green);">
                ${{ "{:,}".format(opportunities|sum(attribute='revenue_potential')|int) }}
            </div>
            <div style="font-size: 12px; color: var(--notion-text-light);">Monthly potential</div>
        </div>
    </div>
    
    <div class="notion-card">
        <div class="card-title">üîç Pending Review</div>
        <div class="card-content">
            <div style="font-size: 32px; font-weight: 600; color: var(--notion-orange);">
                {{ opportunities|selectattr('status', 'equalto', 'identified')|list|length }}
            </div>
            <div style="font-size: 12px; color: var(--notion-text-light);">Need approval</div>
        </div>
    </div>
</div>

<script>
function approveOpportunity(oppId) {
    if (confirm('Approve this opportunity for development? This will move it to the projects pipeline.')) {
        fetch('/api/approve_business_opportunity', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({opportunity_id: oppId})
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Failed to approve opportunity: ' + data.message);
            }
        })
        .catch(error => {
            alert('Error: ' + error);
        });
    }
}

function viewOpportunity(oppId) {
    // Show opportunity details
    alert('Opportunity details view coming soon! ID: ' + oppId);
}

function editOpportunity(oppId) {
    // Edit opportunity
    alert('Opportunity editing coming soon! ID: ' + oppId);
}

function createOpportunity() {
    const title = prompt('Opportunity title:');
    if (!title) return;
    
    const category = prompt('Category (RC/Van Life/3D Printing/General):', 'General');
    const revenueModel = prompt('Revenue model (Product/Service/Subscription/etc.):', 'Product');
    const revenuePotential = prompt('Monthly revenue potential ($):', '1000');
    
    if (title && category && revenueModel && revenuePotential) {
        // This would call an API to create the opportunity
        alert('Manual opportunity creation coming soon!');
    }
}
</script>

<style>
.opportunity-row {
    transition: all 0.2s ease;
}

.opportunity-row:hover {
    background: rgba(0, 0, 0, 0.02);
}

.category-rc { border-left: 4px solid #dc3545; }
.category-van-life { border-left: 4px solid #28a745; }
.category-3d-printing { border-left: 4px solid #007bff; }
.category-general { border-left: 4px solid #ffc107; }

.status-pill.category-rc { background: #fee2e2; color: #dc2626; }
.status-pill.category-van-life { background: #dcfce7; color: #16a34a; }
.status-pill.category-3d-printing { background: #dbeafe; color: #2563eb; }
.status-pill.category-general { background: #fef3c7; color: #d97706; }

.status-pending { background: #fef3c7; color: #d97706; }
.status-active { background: #dcfce7; color: #16a34a; }
.status-in-progress { background: #dbeafe; color: #2563eb; }
.status-default { background: #f3f4f6; color: #6b7280; }
</style>
{% endblock %}